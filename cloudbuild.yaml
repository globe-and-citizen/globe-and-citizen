steps:
  - name: node:20
    entrypoint: npm
    args: ["install"]

  - name: node:20
    entrypoint: npm
    args: ["run", "build"]
    env:
      - "VITE_API_BASE_URL=$$VITE_API_BASE_URL"
      - "VITE_FORWARD_PROXY_URL=$$VITE_FORWARD_PROXY_URL"
      - "VITE_LAYER8_BASE_URL_PROD=$VITE_LAYER8_BASE_URL_PROD"
      - "VITE_LAYER8_BASE_URL_DEV=$VITE_LAYER8_BASE_URL_DEV"
      - "NODE_ENV=production"

  - name: gcr.io/google.com/cloudsdktool/cloud-sdk
    entrypoint: gsutil
    args: ["-m", "rsync", "-r", "dist/", "gs://globeandcitizen.com"]

options:
  defaultLogsBucketBehavior: REGIONAL_USER_OWNED_BUCKET
